{
	"$schema": "https://shadcn-svelte.com/schema/registry-item.json",
	"name": "kanban",
	"title": "Kanban",
	"type": "registry:ui",
	"description": "A kanban board is a visual tool that helps you manage and visualize your work. It is a board with columns, and each column represents a status, e.g. \"Backlog\", \"In Progress\", \"Done\".",
	"dependencies": [
		"@dnd-kit-svelte/core",
		"@dnd-kit-svelte/sortable",
		"@dnd-kit-svelte/svelte",
		"@dnd-kit-svelte/utilities"
	],
	"devDependencies": [
		"bits-ui"
	],
	"registryDependencies": [
		"card",
		"scroll-area"
	],
	"files": [
		{
			"content": "<script lang=\"ts\">\r\n    import { cn } from \"$UTILS$\";\r\n    import { useDroppable } from \"@dnd-kit-svelte/core\";\r\n    import type { Snippet } from \"svelte\";\r\n\r\n    let {\r\n        id,\r\n        class: className,\r\n        children\r\n    }: {\r\n        id: string;\r\n        class?: string;\r\n        children: Snippet;\r\n    } = $props();\r\n\r\n    const droppable = useDroppable({\r\n        id\r\n    });\r\n</script>\r\n\r\n<div\r\n    bind:this={droppable.node.current}\r\n    class={cn(\r\n        \"flex size-full min-h-40 flex-col divide-y overflow-hidden rounded-md border bg-secondary text-xs shadow-sm ring-2 transition-all\",\r\n        droppable.isOver.current ? \"ring-primary\" : \"ring-transparent\",\r\n        className\r\n    )}\r\n>\r\n    {@render children?.()}\r\n</div>\r\n",
			"type": "registry:file",
			"target": "../kibo-ui/kanban/kanban-board.svelte"
		},
		{
			"content": "<script lang=\"ts\" generics=\"T extends KanbanItemProps = KanbanItemProps\">\r\n    import { Card } from \"$lib/components/ui/card\";\r\n    import type { Snippet } from \"svelte\";\r\n    import type { KanbanItemProps } from \"./types\";\r\n    import { cn } from \"$UTILS$\";\r\n    import { useSortable } from \"@dnd-kit-svelte/sortable\";\r\n    import { CSS, styleObjectToString } from '@dnd-kit-svelte/utilities';\r\n    import { getContext } from \"./kanban-context.svelte\";\r\n\r\n\r\n    type KanbanCardProps<T extends KanbanItemProps = KanbanItemProps> = T & {\r\n        class?: string;\r\n        children?: Snippet;\r\n    };\r\n\r\n    let {\r\n        id,\r\n        name,\r\n        class: className,\r\n        children\r\n    }: KanbanCardProps<T> = $props();\r\n    \r\n    const {\r\n        attributes,\r\n        listeners,\r\n        node,\r\n        transition,\r\n        transform,\r\n        isDragging,\r\n        isSorting\r\n    } = useSortable({\r\n        id: () => id\r\n    });\r\n\r\n    const ctx = getContext();\r\n\r\n    //const { activeCardId } = useContext(KanbanContext) as KanbanContextProps;\r\n\r\n    // const style = {\r\n    //     transition,\r\n    //     transform: CSS.Transform.toString(transform),\r\n    // };\r\n\r\n    let isOverlay = false;\r\n\r\n    $effect(() => {\r\n        console.log(\"effect\");\r\n        if (ctx.activeCardId == id) {\r\n            ctx.activeCardSnippet = overlay;\r\n            isOverlay = true;\r\n            console.log(\"set snippet\")\r\n        } else if (isOverlay) { // only unset if this card was the overlay card\r\n            ctx.activeCardSnippet = undefined;\r\n            isOverlay = false;\r\n            console.log(\"unset snippet\")\r\n        }\r\n    })\r\n\r\n    const style = $derived(\r\n\t\tstyleObjectToString({\r\n            transition: transition.current,\r\n\t\t\ttransform: CSS.Transform.toString(transform.current),\r\n\t\t})\r\n\t);\r\n\r\n</script>\r\n<!--style={style} {...listeners} {...attributes}-->\r\n<div bind:this={node.current} {style} {...listeners.current} {...attributes.current}>\r\n    <Card\r\n        class={cn(\r\n            \"cursor-grab gap-4 rounded-md p-3 shadow-sm\",\r\n            isDragging.current && \"pointer-events-none cursor-grabbing opacity-30\",\r\n            className\r\n        )}\r\n    >\r\n        {#if children}\r\n            {@render children()}\r\n        {:else}\r\n            <p class=\"m-0 font-medium text-sm\">{name}</p>    \r\n        {/if}\r\n    </Card>\r\n</div>\r\n\r\n{#snippet overlay()}\r\n    <Card\r\n        class={cn(\r\n            \"cursor-grab gap-4 rounded-md p-3 shadow-sm ring-2 ring-primary\",\r\n            isDragging && \"cursor-grabbing\",\r\n            className\r\n        )}\r\n    >\r\n        {#if children}\r\n            {@render children()}\r\n        {:else}\r\n            <p class=\"m-0 font-medium text-sm\">{name}</p>    \r\n        {/if}\r\n    </Card>\r\n{/snippet}\r\n<!-- {#if activeCardId === id}\r\n    <t.In>\r\n        <Card\r\n            class={cn(\r\n                \"cursor-grab gap-4 rounded-md p-3 shadow-sm ring-2 ring-primary\",\r\n                isDragging && \"cursor-grabbing\",\r\n                className\r\n            )}\r\n        >\r\n            {#if children}\r\n                {@render children()}\r\n            {:else}\r\n                <p class=\"m-0 font-medium text-sm\">{name}</p>    \r\n            {/if}\r\n        </Card>\r\n    </t.In>\r\n{/if} -->\r\n\r\n\r\n",
			"type": "registry:file",
			"target": "../kibo-ui/kanban/kanban-card.svelte"
		},
		{
			"content": "<script lang=\"ts\" generics=\"T extends KanbanItemProps = KanbanItemProps\">\r\n    import { ScrollArea } from '$lib/components/ui/scroll-area';\r\n    import type { Snippet } from 'svelte';\r\n    import type { HTMLAttributes } from 'svelte/elements';\r\n    import type { KanbanItemProps } from './types';\r\n    import { getContext } from './kanban-context.svelte';\r\n    import { SortableContext } from '@dnd-kit-svelte/sortable';\r\n    import { cn } from '$UTILS$';\r\n    \r\n\r\n    let {\r\n        id,\r\n        class: className,\r\n        child,\r\n        ...restProps\r\n    }: Omit<HTMLAttributes<HTMLDivElement>, \"children\"> & {\r\n        child: Snippet<[{ item: T}]>;\r\n    } = $props();\r\n\r\n    const ctx = getContext();\r\n\r\n    const filteredData = $derived(ctx.data.filter((item) => item.column === id));\r\n    const items = $derived(filteredData.map(i => i.id));\r\n</script>\r\n\r\n<ScrollArea class=\"overflow-hidden\">\r\n    <SortableContext {items}>\r\n        <div\r\n            class={cn(\"flex flex-grow flex-col gap-2 p-2\", className)}\r\n            {...restProps}\r\n        >\r\n            {#each filteredData as item(item.id)}\r\n                {@render child({ item })}\r\n            {/each}\r\n        </div>\r\n    </SortableContext>\r\n</ScrollArea>\r\n",
			"type": "registry:file",
			"target": "../kibo-ui/kanban/kanban-cards.svelte"
		},
		{
			"content": "<script lang=\"ts\">\r\n    import { cn } from \"$UTILS$\";\r\n    import type { HTMLAttributes } from \"svelte/elements\";\r\n\r\n    let {\r\n        class: className,\r\n        children,\r\n        ...restProps\r\n    }: HTMLAttributes<HTMLDivElement> = $props();\r\n</script>\r\n\r\n<div \r\n    class={cn(\"m-0 p-2 font-semibold text-sm\", className)} \r\n    {...restProps}\r\n>\r\n    {@render children?.()}\r\n</div>\r\n",
			"type": "registry:file",
			"target": "../kibo-ui/kanban/kanban-header.svelte"
		},
		{
			"content": "<script lang=\"ts\">\r\n    import { cn } from \"$UTILS$\";\r\n    import { DndContext, type DragEndEvent, type DragOverEvent, type DragStartEvent, useSensor, useSensors, KeyboardSensor, PointerSensor, DragOverlay, type Announcements, closestCenter } from \"@dnd-kit-svelte/core\";\r\n    import type { KanbanColumnProps, KanbanItemProps } from \"./types\";\r\n    import { setupContext } from \"./kanban-context.svelte\";\r\n    import type { Snippet } from \"svelte\";\r\n    import { arrayMove } from '@dnd-kit-svelte/sortable';\r\n    import { Portal } from \"bits-ui\";\r\n\r\n    type KanbanProviderProps<\r\n        T extends KanbanItemProps = KanbanItemProps,\r\n        C extends KanbanColumnProps = KanbanColumnProps,\r\n    > = {\r\n        columns: C[];\r\n        data: T[];\r\n        class?: string;\r\n        child: Snippet<[{ column: C }]>;\r\n        onDataChange?: (data: T[]) => void;\r\n        onDragStart?: (event: DragStartEvent) => void;\r\n        onDragEnd?: (event: DragEndEvent) => void;\r\n        onDragOver?: (event: DragOverEvent) => void;\r\n    };\r\n\r\n    let {\r\n        columns,\r\n        data,\r\n        class: className,\r\n        child,\r\n        onDragStart,\r\n        onDragEnd,\r\n        onDragOver,\r\n        onDataChange,\r\n        ...restProps\r\n    }: KanbanProviderProps = $props();\r\n\r\n    let activeCardId = $state<string | null>(null);\r\n\r\n    const ctx = setupContext({\r\n        columns: () => columns,\r\n        data: () => data,\r\n        activeCardId: () => activeCardId\r\n    });\r\n\r\n    const sensors = useSensors(useSensor(PointerSensor), useSensor(KeyboardSensor));\r\n\r\n    const handleDragStart = (event: DragStartEvent) => {\r\n        const card = ctx.data.find((item) => item.id === event.active.id);\r\n        if (card) {\r\n            activeCardId = event.active.id as string;\r\n        }\r\n        onDragStart?.(event);\r\n    };\r\n\r\n    const handleDragOver = (event: DragOverEvent) => {\r\n        const { active, over } = event;\r\n\r\n        if (!over) {\r\n            return;\r\n        }\r\n\r\n        const activeItem = ctx.data.find((item) => item.id === active.id);\r\n        const overItem = ctx.data.find((item) => item.id === over.id);\r\n\r\n        if (!activeItem) {\r\n            return;\r\n        }\r\n\r\n        const activeColumn = activeItem.column;\r\n        const overColumn =\r\n            overItem?.column ||\r\n            columns.find((col) => col.id === over.id)?.id ||\r\n            columns[0]?.id;\r\n\r\n        if (activeColumn !== overColumn) {\r\n            const activeIndex = ctx.data.findIndex((item) => item.id === active.id);\r\n            const overIndex = ctx.data.findIndex((item) => item.id === over.id);\r\n\r\n            ctx.data[activeIndex].column = overColumn;\r\n            ctx.data = arrayMove(ctx.data, activeIndex, overIndex);\r\n\r\n            onDataChange?.(ctx.data);\r\n        }\r\n\r\n        onDragOver?.(event);\r\n    };\r\n\r\n    const handleDragEnd = (event: DragEndEvent) => {\r\n        activeCardId = null;\r\n\r\n        onDragEnd?.(event);\r\n\r\n        const { active, over } = event;\r\n\r\n        if (!over || active.id === over.id) {\r\n            return;\r\n        }\r\n\r\n        const oldIndex = ctx.data.findIndex((item) => item.id === active.id);\r\n        const newIndex = ctx.data.findIndex((item) => item.id === over.id);\r\n\r\n        ctx.data = arrayMove(ctx.data, oldIndex, newIndex);\r\n\r\n        onDataChange?.(ctx.data);\r\n    };\r\n\r\n    const announcements: Announcements = {\r\n        onDragStart({ active }) {\r\n        const { name, column } = data.find((item) => item.id === active.id) ?? {};\r\n\r\n        return `Picked up the card \"${name}\" from the \"${column}\" column`;\r\n        },\r\n        onDragOver({ active, over }) {\r\n        const { name } = data.find((item) => item.id === active.id) ?? {};\r\n        const newColumn = columns.find((column) => column.id === over?.id)?.name;\r\n\r\n        return `Dragged the card \"${name}\" over the \"${newColumn}\" column`;\r\n        },\r\n        onDragEnd({ active, over }) {\r\n        const { name } = data.find((item) => item.id === active.id) ?? {};\r\n        const newColumn = columns.find((column) => column.id === over?.id)?.name;\r\n\r\n        return `Dropped the card \"${name}\" into the \"${newColumn}\" column`;\r\n        },\r\n        onDragCancel({ active }) {\r\n        const { name } = data.find((item) => item.id === active.id) ?? {};\r\n\r\n        return `Cancelled dragging the card \"${name}\"`;\r\n        },\r\n    };\r\n</script>\r\n\r\n<DndContext\r\n    accessibility={{ announcements }}\r\n    collisionDetection={closestCenter}\r\n    onDragEnd={handleDragEnd}\r\n    onDragOver={handleDragOver}\r\n    onDragStart={handleDragStart}\r\n    {sensors}\r\n    {...restProps}\r\n>\r\n    <div\r\n        class={cn(\r\n            \"grid size-full auto-cols-fr grid-flow-col gap-4\",\r\n            className\r\n        )}\r\n    >\r\n        {#each columns as column}\r\n            {@render child({ column })}\r\n        {/each}\r\n    </div>\r\n\r\n    {#if typeof window !== \"undefined\"}\r\n        <Portal>\r\n            <DragOverlay>\r\n                {@render ctx.activeCardSnippet?.()}\r\n            </DragOverlay>\r\n        </Portal>\r\n        \r\n    {/if}\r\n</DndContext>\r\n",
			"type": "registry:file",
			"target": "../kibo-ui/kanban/kanban-provider.svelte"
		},
		{
			"content": "import { createContext, type Snippet } from \"svelte\";\r\nimport type { KanbanColumnProps, KanbanItemProps } from \"./types\";\r\n\r\ntype KanbanStateProps<\r\n  T extends KanbanItemProps = KanbanItemProps,\r\n  C extends KanbanColumnProps = KanbanColumnProps\r\n> = {\r\n    columns: () => C[];\r\n    data: () => T[];\r\n    activeCardId: () => string | null;\r\n}\r\n\r\nclass KanbanState<\r\n    T extends KanbanItemProps = KanbanItemProps,\r\n    C extends KanbanColumnProps = KanbanColumnProps\r\n> {\r\n    #columns: C[];\r\n    #data: T[];\r\n    #activeCardId: string | null;\r\n\r\n    #activeCardSnippet = $state<Snippet>();\r\n\r\n    constructor(props: KanbanStateProps<T, C>) {\r\n        this.#columns = $derived(props.columns());\r\n        this.#data = $derived(props.data());\r\n        this.#activeCardId = $derived(props.activeCardId());\r\n    };\r\n\r\n    get columns() { return this.#columns };\r\n    set columns(v) { this.#columns = v };\r\n\r\n    get data() { return this.#data };\r\n    set data(v) { this.#data = v };\r\n\r\n    get activeCardId() { return this.#activeCardId };\r\n    set activeCardId(v) { this.#activeCardId = v };\r\n\r\n    get activeCardSnippet() { return this.#activeCardSnippet };\r\n    set activeCardSnippet(v) { this.#activeCardSnippet = v };\r\n};\r\n\r\nconst [ getContext, setContext ] = createContext<KanbanState>();\r\n\r\nfunction setupContext<\r\n    T extends KanbanItemProps = KanbanItemProps,\r\n    C extends KanbanColumnProps = KanbanColumnProps\r\n>(props: KanbanStateProps<T, C>) {\r\n    return setContext(new KanbanState<T, C>(props));\r\n};\r\n\r\nexport {\r\n    type KanbanStateProps,\r\n    type KanbanState,\r\n    setupContext,\r\n    getContext\r\n};\r\n",
			"type": "registry:file",
			"target": "../kibo-ui/kanban/kanban-context.svelte.ts"
		},
		{
			"content": "export type KanbanItemProps = {\r\n    id: string;\r\n    index: number;\r\n    name: string;\r\n    column: string;\r\n} & Record<string, unknown>;\r\n\r\nexport type KanbanColumnProps = {\r\n  id: string;\r\n  name: string;\r\n} & Record<string, unknown>;\r\n\r\n",
			"type": "registry:file",
			"target": "../kibo-ui/kanban/types.ts"
		},
		{
			"content": "import KanbanBoard from \"./kanban-board.svelte\";\r\nimport KanbanCard from \"./kanban-card.svelte\";\r\nimport KanbanCards from \"./kanban-cards.svelte\";\r\nimport KanbanHeader from \"./kanban-header.svelte\";\r\nimport KanbanProvider from \"./kanban-provider.svelte\";\r\n\r\nexport {\r\n    KanbanBoard,\r\n    KanbanCard,\r\n    KanbanCards,\r\n    KanbanHeader,\r\n    KanbanProvider,\r\n\r\n    KanbanBoard as Board,\r\n    KanbanCard as Card,\r\n    KanbanCards as Cards,\r\n    KanbanHeader as Header,\r\n    KanbanProvider as Provider\r\n};\r\n",
			"type": "registry:file",
			"target": "../kibo-ui/kanban/index.ts"
		}
	]
}